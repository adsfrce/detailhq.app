<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DetailHQ</title>
  <link rel="icon" type="image/png" href="app_icon.PNG" />
  <link rel="apple-touch-icon" href="app_icon.PNG" />
  <meta name="theme-color" content="#000000" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style-app.css" />

  <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
</head>
<body class="theme-system">
  <div id="loadingView" style="display:none; height:100vh; align-items:center; justify-content:center;">
  Loading...
</div>

  <div id="app-root">
    <div id="auth-view" class="view">
      <div class="auth-card glass">
        <div class="auth-logo-row">
          <img src="logo_icon.PNG" alt="DetailHQ Logo" class="app-logo" />
          <div>
            <h1 class="app-title">DetailHQ</h1>
            <p class="app-subtitle">
              Backoffice for detailers & wrappers.
            </p>
          </div>
        </div>

        <form id="login-form" class="form">
          <label class="field-label" for="login-email">Email</label>
          <input id="login-email" type="email" class="field-input" autocomplete="email" required />

<label class="field-label" for="login-password">Password</label>
<div class="password-wrap">
  <input id="login-password" type="password" class="field-input" autocomplete="current-password" required />
  <button type="button" class="password-toggle" data-target="login-password">Show</button>
</div>

          <button type="submit" class="btn btn-primary" id="login-button">
            Log In
          </button>

          <button type="button" class="link-button" id="password-reset-button">
            Forgot password?
          </button>

          <p class="form-hint">
            No account yet?
            <button type="button" class="link-button" id="register-switch">
              Register now
            </button>
          </p>
        </form>

        <form id="register-form" class="form hidden">
          <div class="auth-info-banner">
            <strong>7 days free trial.</strong><br />
            No payment method required for the trial phase.
          </div>

<label class="field-label" for="register-company">Company Name</label>
<input
  id="register-company"
  type="text"
  class="field-input"
  autocomplete="organization"
  required
/>

          <label class="field-label" for="register-business-types">Industry</label>

<div class="settings-dropdown" style="margin-bottom: 14px;">
  <button
    type="button"
    class="settings-dropdown-toggle"
    id="register-business-toggle"
    aria-expanded="false"
  >
    <span id="register-business-label">Choose industry</span>
    <span class="settings-dropdown-chevron">▾</span>
  </button>

  <div id="register-business-menu" class="settings-dropdown-menu">
    <p class="form-hint">Please select…</p>
  </div>
</div>

<select id="register-business-types" multiple class="hidden"></select>

<p class="form-hint" style="margin-top:-6px;">
  Multiple selection possible (e.g., Detailing + Wrapping).
</p>

          <label class="field-label" for="register-email">Email</label>
          <input id="register-email" type="email" class="field-input" autocomplete="email" required />
          
<label class="field-label" for="register-password">Password</label>
<div class="password-wrap">
  <input id="register-password" type="password" class="field-input" autocomplete="new-password" required />
  <button type="button" class="password-toggle" data-target="register-password">Show</button>
</div>

          <button type="submit" class="btn btn-primary" id="register-button">
            Create account
          </button>

          <p class="form-hint">
            Already have an account?
            <button type="button" class="link-button" id="login-switch">
              To login
            </button>
          </p>
        </form>

        <p id="auth-error" class="error-text"></p>
      </div>
    </div>

    <div id="app-view" class="view">
      <header class="app-header glass">
        <div class="header-left">
          <img src="logo_icon.PNG" alt="DetailHQ Logo" class="header-logo" />
          <div>
            <h2 id="header-title">Dashboard</h2>
            <p id="header-subtitle" class="header-subtitle">
              Overview of your orders and revenue.
            </p>
          </div>
        </div>

        <div class="profile-wrapper">
          <button id="profile-button" class="icon-button profile-avatar" title="Profile">
            <img
              id="profile-avatar-image"
              src="pfp.png"
              alt="Profile picture"
              class="profile-avatar-image"
            />
          </button>
          <div id="profile-menu" class="profile-menu hidden">
            <button id="profile-manage-button" class="profile-menu-item">
              Manage profile
            </button>
            <button id="profile-logout-button" class="profile-menu-item danger">
              Log out
            </button>
          </div>
        </div>
      </header>

      <div id="trial-banner" class="trial-banner hidden">
        <span id="trial-banner-text"></span>
        <button id="trial-banner-button" class="trial-banner-button">
          Start subscription now
        </button>
      </div>

      <main class="app-main">
        <section id="tab-dashboard" class="tab-section active">
      <div class="dashboard-period-row">
        <div class="dashboard-period-toggle" id="dashboard-period-toggle">
          <button class="period-chip active" data-period="today">Today</button>
          <button class="period-chip" data-period="week">Week</button>
          <button class="period-chip" data-period="month">Month</button>
          <button class="period-chip" data-period="year">Year</button>
        </div>
      </div>

      <div class="cards-grid cards-grid-2">
        <div class="card glass">
          <p class="card-label">Revenue</p>
          <p class="card-value" id="revenue-today">$ 0</p>
        </div>

        <div class="card glass">
          <p class="card-label">Order Volume</p>
          <p class="card-value" id="volume-today">$ 0</p>
        </div>
      </div>

      <div style="display:none;">
        <span id="revenue-week"></span>
        <span id="revenue-14days"></span>
        <span id="revenue-month"></span>
      </div>

          <div class="section-header">
            <h3>Today's Orders</h3>
            <button id="new-booking-button" class="btn btn-secondary btn-small">
              New Order
            </button>
          </div>
          <div id="today-bookings" class="list-container empty-state">
            <p>No orders for today yet.</p>
          </div>

          <div class="section-header">
            <h3>Reviews Due</h3>
          </div>
          <div id="review-reminders" class="list-container empty-state">
            <p>No open review reminders at the moment.</p>
          </div>
        </section>

<section id="tab-orders" class="tab-section">
  <div class="section-header">
    <h3>New Intake Protocol</h3>
  </div>

  <div id="intake-start-panel" class="glass" style="padding:12px; margin-bottom:12px;">
    <p class="form-hint" style="margin:0 0 10px;">
      Select an order and start the intake protocol.
    </p>

    <label class="field-label" for="intake-booking-select">Order</label>
    <select id="intake-booking-select" class="field-input">
      <option value="">Please select…</option>
    </select>

    <button id="intake-open-button" class="btn btn-primary" type="button" style="margin-top:10px;">
      Next
    </button>

    <p id="intake-start-error" class="error-text" style="margin-top:10px;"></p>
  </div>

  <div class="section-header" style="margin-top:10px;">
    <h3>Completed Protocols</h3>
  </div>

  <div id="intake-list" class="list-container empty-state">
    <p>No intake protocols created yet.</p>
  </div>
</section>


        <section id="tab-schedule" class="tab-section">
          <div class="section-header">
            <h3>Schedule</h3>
            <button id="new-booking-button-2" class="btn btn-secondary btn-small">
              New Order
            </button>
          </div>
          <div id="schedule-list" class="list-container empty-state">
            <p>No scheduled orders yet.</p>
          </div>
        </section>

        <section id="tab-settings" class="tab-section">

  <div id="settings-hub">
    <div class="settings-switch">
      <button id="open-service-settings" class="settings-switch-btn" type="button">
        <div class="settings-switch-title">Service</div>
        <div class="settings-switch-sub">Booking, Services, Opening Hours</div>
      </button>

      <button id="open-business-settings" class="settings-switch-btn" type="button">
        <div class="settings-switch-title">Business</div>
        <div class="settings-switch-sub">Calendar, Subscription, Reviews, Design</div>
      </button>
    </div>
  </div>

  <div id="settings-view-service" class="hidden">
    <button id="back-from-service" class="icon-button small" type="button" title="Back">←</button>

    <div class="settings-group glass">
      <h3>Services & Prices</h3>
      <p class="settings-help">
        Define vehicle classes and services. You will use these later when creating orders.
      </p>

      <h4 class="settings-subtitle">Vehicle Classes</h4>

      <div class="settings-dropdown">
        <button type="button" class="settings-dropdown-toggle" id="vehicle-classes-dropdown-toggle">
          Adjust vehicle classes
          <span class="settings-dropdown-chevron">▾</span>
        </button>

        <div id="vehicle-classes-list" class="settings-dropdown-menu">
          <p class="form-hint">No vehicle classes created yet.</p>
        </div>
      </div>

      <button class="btn btn-secondary btn-small" id="vehicle-class-add-button">
        Add vehicle class
      </button>

      <h4 class="settings-subtitle" style="margin-top:16px;">Services</h4>

      <div class="settings-dropdown">
        <button type="button" class="settings-dropdown-toggle" id="services-dropdown-toggle">
          Adjust services
          <span class="settings-dropdown-chevron">▾</span>
        </button>

        <div id="services-list" class="settings-dropdown-menu">
          <p class="form-hint">No services created yet.</p>
        </div>
      </div>

      <button class="btn btn-secondary btn-small" id="service-add-button">
        Add service
      </button>
    </div>

    <div class="settings-group glass">
      <h3>Booking Link</h3>
      <p class="settings-help">
        Your customers will see this link. They can use it to book an appointment directly.
      </p>

      <label class="field-label" for="settings-booking-link">Your Booking Link</label>
      <input id="settings-booking-link" type="text" class="field-input" readonly />

      <button id="settings-booking-link-copy" class="btn btn-secondary btn-block" style="margin-top:8px;">
        Copy link
      </button>

      <button id="settings-booking-link-open" class="btn btn-ghost btn-block" style="margin-top:8px;">
        Open link
      </button>

<p id="settings-booking-link-status" class="form-hint"></p>
</div>

<div class="settings-group glass" id="settings-discounts">
  <h3>Vouchers</h3>
  <p class="settings-help">
    Promo codes and gift cards for your customer booking portal.
  </p>

  <h4 class="settings-subtitle">Create Promo Code</h4>

  <label class="field-label" for="promo-code-input">Code</label>
  <input id="promo-code-input" type="text" class="field-input" placeholder="WINTER25" style="text-transform:uppercase;" />

<div style="display:flex;flex-direction:column;gap:10px;margin-top:10px;">

  <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">

  <input
    id="promo-value-input"
    type="number"
    class="field-input"
    placeholder="Value (e.g., 25)"
    style="max-width:180px;"
  />

  <label class="radio-pill">
    <input id="promo-type-percent" type="radio" name="promoType" checked />
    <span>%</span>
  </label>

  <label class="radio-pill">
    <input id="promo-type-amount" type="radio" name="promoType" />
    <span>$</span>
  </label>

</div>

<div class="promo-row-2" style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;">

  <div style="display:flex;flex-direction:column;gap:6px;max-width:180px;">
    <div class="form-hint" style="margin:0;">Max uses (optional)</div>
    <input id="promo-max-uses" type="number" class="field-input" placeholder="e.g., 5" style="max-width:180px;" />
  </div>

  <div class="date-wrap" style="display:flex;flex-direction:column;gap:6px;max-width:180px;">
    <div class="form-hint" style="margin:0;">Valid until (optional)</div>
    <input id="promo-valid-until" type="text" class="field-input" placeholder="MM/DD/YYYY" style="max-width:180px;" inputmode="numeric" />
  </div>

  <button id="promo-create-btn" class="btn btn-secondary promo-save-btn" type="button" style="white-space:nowrap;">
    Save
  </button>

</div>

  <p id="promo-status" class="form-hint"></p>

<details class="settings-dropdown" style="margin-top:10px;">
  <summary class="settings-dropdown-toggle">Manage Promo Codes</summary>
  <div id="promo-list" class="settings-dropdown-menu">
    <p class="form-hint">Loading...</p>
  </div>
</details>

  <div style="height:14px;"></div>

  <h4 class="settings-subtitle">Issue Gift Card</h4>

  <label class="field-label" for="gift-amount-input">Value (in $)</label>
  <input id="gift-amount-input" type="number" class="field-input" placeholder="50" />

  <label class="field-label" for="gift-to-email" style="margin-top:10px;">Recipient Email (optional)</label>
  <input id="gift-to-email" type="email" class="field-input" placeholder="customer@email.com" />

  <label class="field-label" for="gift-to-name" style="margin-top:10px;">Recipient Name (optional)</label>
  <input id="gift-to-name" type="text" class="field-input" placeholder="John Doe" />

  <label class="field-label" for="gift-message" style="margin-top:10px;">Message (optional)</label>
  <textarea id="gift-message" class="field-input" placeholder="Short text for the email / PDF"></textarea>

  <button id="gift-issue-btn" class="btn btn-primary btn-block" type="button" style="margin-top:12px;">
    Create Gift Card
  </button>

  <p id="gift-status" class="form-hint"></p>
  
<div id="gift-last" class="settings-list" style="margin-top:10px; display:none;"></div>

<details class="settings-dropdown" style="margin-top:10px;">
  <summary class="settings-dropdown-toggle">Manage Gift Cards</summary>
  <div id="gift-list" class="settings-dropdown-menu">
    <p class="form-hint">Loading...</p>
  </div>
</details>
</div>
</div>

<div class="settings-group glass" id="settings-opening-hours">
      <h3>Opening Hours</h3>
      <p class="settings-help">
        These times only apply to customer bookings via your booking link.
      </p>

      <div class="opening-hours-list">
        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-mon-open" type="checkbox" class="opening-hours-check" />
            <span>Monday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-mon-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-mon-end" type="time" class="opening-hours-input" />
          </div>
        </div>

        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-tue-open" type="checkbox" class="opening-hours-check" />
            <span>Tuesday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-tue-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-tue-end" type="time" class="opening-hours-input" />
          </div>
        </div>

        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-wed-open" type="checkbox" class="opening-hours-check" />
            <span>Wednesday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-wed-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-wed-end" type="time" class="opening-hours-input" />
          </div>
        </div>

        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-thu-open" type="checkbox" class="opening-hours-check" />
            <span>Thursday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-thu-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-thu-end" type="time" class="opening-hours-input" />
          </div>
        </div>

        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-fri-open" type="checkbox" class="opening-hours-check" />
            <span>Friday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-fri-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-fri-end" type="time" class="opening-hours-input" />
          </div>
        </div>

        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-sat-open" type="checkbox" class="opening-hours-check" />
            <span>Saturday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-sat-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-sat-end" type="time" class="opening-hours-input" />
          </div>
        </div>

        <div class="opening-hours-row">
          <label class="opening-hours-day">
            <input id="oh-sun-open" type="checkbox" class="opening-hours-check" />
            <span>Sunday</span>
          </label>
          <div class="opening-hours-pill">
            <input id="oh-sun-start" type="time" class="opening-hours-input" />
            <span class="opening-hours-sep">–</span>
            <input id="oh-sun-end" type="time" class="opening-hours-input" />
          </div>
        </div>
      </div>

      <div style="margin-top: 18px;">
        <label class="field-label" for="settings-public-daily-limit">
          Max. appointments per day (customer bookings only)
        </label>
        <select id="settings-public-daily-limit" class="field-input">
          <option value="1">1</option><option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option><option value="9">9</option>
          <option value="10">10</option>
        </select>
        <p class="form-hint" style="margin-top: 6px;">
          Only applies to bookings via your booking link. Internal orders remain unlimited.
        </p>
      </div>

      <button id="opening-hours-save-button" class="btn btn-secondary" style="margin-top: 10px;">
        Save
      </button>
      <p id="opening-hours-save-status" class="form-hint"></p>
    </div>
  </div>

  <div id="settings-view-business" class="hidden">
    <button id="back-from-business" class="icon-button small" type="button" title="Back">←</button>

    <div class="settings-group glass">
      <h3>Calendar</h3>
      <p class="settings-help">
        Connect your DetailHQ schedule with Apple Calendar or Google Calendar.
      </p>

      <div class="settings-options">
        <label class="radio-option">
          <input type="radio" name="calendar-preference" value="apple" />
          <span>Apple</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="calendar-preference" value="google" />
          <span>Google</span>
        </label>
      </div>

      <button id="calendar-open-button" class="btn btn-secondary btn-block" style="margin-top: 10px;">
        Open in Calendar
      </button>
    </div>

    <div class="settings-group glass" id="settings-billing">
      <h3>Payment & Subscription</h3>
      <p class="settings-help">
        Payment details, invoices, and cancellation in the Stripe portal.
      </p>

      <button class="btn btn-ghost btn-block" id="billing-manage-plan-button">
        Manage Payment & Subscription
      </button>
    </div>

    <div class="settings-group glass">
      <h3>Reviews</h3>
      <p class="settings-help">
        Enter your Google profile or review link for reminders after orders.
      </p>
      <label class="field-label" for="settings-review-link">Google Profile URL</label>
      <input id="settings-review-link" type="url" class="field-input" placeholder="https://www.google.com/maps/place/..." />

      <button id="settings-review-save-button" class="btn btn-secondary" style="margin-top: 8px;">
        Save
      </button>
      <p id="settings-review-save-status" class="form-hint"></p>
    </div>

    <div class="settings-group glass">
      <h3>Appearance</h3>
      <p class="settings-help">Choose how DetailHQ should look.</p>
      <div class="settings-options">
        <label class="radio-option">
          <input type="radio" name="theme" value="light" />
          <span>Light</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="theme" value="dark" />
          <span>Dark</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="theme" value="system" />
          <span>System</span>
        </label>
      </div>
    </div>
  </div>

  <div class="settings-group glass">
    <h3>Support</h3>
    <p class="settings-help">
      If you have any questions or problems, just get in touch.
    </p>
    <a href="https://detailhq.app/support" class="btn btn-secondary btn-block">
      Create support ticket
    </a>
  </div>

  <div class="settings-group glass">
    <h3>Legal</h3>
    <p class="settings-help">
      Imprint, privacy policy & legal notices for DetailHQ.
    </p>
    <a href="https://detailhq.app/legal" class="btn btn-ghost btn-block" target="_blank" rel="noopener noreferrer">
      Open legal notices
    </a>
  </div>

  <div id="service-modal" class="profile-modal hidden">
  <div class="profile-modal-backdrop"></div>
  <div class="profile-modal-card glass">
    <div class="profile-modal-header">
      <h3 id="service-modal-title">Edit Service</h3>
      <button id="service-modal-close" class="icon-button small" title="Close">✕</button>
    </div>

    <form id="service-form" class="form">
      <div class="form-row">
        <label class="field-label" for="service-kind">Type</label>
        <select id="service-kind" class="field-input">
          <option value="single">Single service</option>
          <option value="package">Package</option>
        </select>
      </div>

      <div class="form-row">
        <label class="field-label" for="service-category">Category (optional)</label>
        <input id="service-category" class="field-input" type="text" placeholder="e.g., Interior" />
      </div>

      <div class="form-row">
        <label class="field-label" for="service-name">Service Name</label>
        <input id="service-name" class="field-input" type="text" placeholder="e.g., Full Interior" />
      </div>

      <div class="form-row">
        <label class="field-label" for="service-base-price-input">Base Price ($)</label>
        <input id="service-base-price-input" class="field-input" type="number" inputmode="decimal" placeholder="e.g., 149" />

        <div id="service-price-reco" class="service-price-reco hidden">
          <div class="service-price-reco-row">
            <span class="service-price-reco-label">Recommendation:</span>
            <span id="service-price-reco-min"></span>
            <span>–</span>
            <span id="service-price-reco-max"></span>
          </div>
          <div id="service-price-reco-hint" class="service-price-reco-hint"></div>
        </div>
      </div>

      <div class="form-row">
        <label class="field-label" for="service-duration-input">Duration (hrs.)</label>
        <input id="service-duration-input" class="field-input" type="number" step="0.25" inputmode="decimal" placeholder="e.g., 2" />
      </div>

      <div class="form-row">
        <label class="field-label" for="service-notes-input">Notes / Description</label>
        <textarea id="service-notes-input" class="field-input" rows="3" placeholder="Optional: Internal notes"></textarea>
      </div>

      <p id="service-modal-error" class="error-text"></p>

      <div class="modal-actions">
        <button id="service-delete-button" type="button" class="btn btn-ghost">Delete</button>
        <button id="service-save-button" type="submit" class="btn btn-secondary">Save</button>
      </div>
    </form>
  </div>
</div>
  
<div id="vehicle-class-modal" class="profile-modal hidden">
  <div class="profile-modal-backdrop"></div>
  <div class="profile-modal-card glass">
    <div class="profile-modal-header">
      <h3 id="vehicle-class-modal-title">Edit Vehicle Class</h3>
      <button id="vehicle-class-modal-close" class="icon-button small" title="Close">✕</button>
    </div>

    <form id="vehicle-class-form" class="form">
      <div class="form-row">
        <label class="field-label" for="vehicle-class-name">Name</label>
        <input id="vehicle-class-name" class="field-input" type="text" placeholder="e.g., Compact" />
      </div>

      <div class="form-row">
        <label class="field-label" for="vehicle-class-price-delta">Price Adjustment ($)</label>
        <input id="vehicle-class-price-delta" class="field-input" type="number" step="1" inputmode="decimal" placeholder="e.g., 20" />
        <p class="form-hint">Example: 0 = no extra charge, 20 = +$20, -10 = -$10</p>
      </div>

      <p id="vehicle-class-modal-error" class="error-text"></p>

      <div class="modal-actions">
        <button id="vehicle-class-delete-button" type="button" class="btn btn-ghost">Delete</button>
        <button id="vehicle-class-save-button" type="submit" class="btn btn-secondary">Save</button>
      </div>
    </form>
  </div>
</div>
</section>
        
      </main>

      <div id="profile-modal" class="profile-modal hidden">
        <div class="profile-modal-backdrop"></div>
        <div class="profile-modal-card glass">
          <div class="profile-modal-header">
            <h3>Manage Profile</h3>
            <button id="profile-close-button" class="icon-button small" title="Close">
              ✕
            </button>
          </div>
          <form id="profile-form" class="form">
            <label class="field-label" for="profile-name">Name</label>
            <input id="profile-name" type="text" class="field-input" />

            <label class="field-label" for="profile-company">Company</label>
            <input id="profile-company" type="text" class="field-input" />

            <label class="field-label" for="profile-address">Address</label>
            <input id="profile-address" type="text" class="field-input" />

            <label class="field-label" for="profile-avatar-file">Profile Picture (optional)</label>
            <input id="profile-avatar-file" type="file" accept="image/*" class="field-input" />

            <button type="submit" class="btn btn-primary">
              Save
            </button>
          </form>
          <p id="profile-save-message" class="form-hint"></p>
        </div>
      </div>

      <div id="booking-modal" class="profile-modal hidden">
        <div class="profile-modal-backdrop"></div>
        <div class="profile-modal-card glass">
          <div class="profile-modal-header">
            <h3>New Order</h3>
            <button id="booking-close-button" class="icon-button small" title="Close">✕</button>
          </div>

          <div class="booking-steps-indicator">
            <span id="booking-step-indicator-1" class="booking-step-indicator active">1. Services</span>
            <span id="booking-step-indicator-2" class="booking-step-indicator">2. Date</span>
            <span id="booking-step-indicator-3" class="booking-step-indicator">3. Customer</span>
          </div>

          <form id="booking-form" class="form">
            <div class="booking-step" id="booking-step-1" data-step="1">
              <label class="field-label" for="booking-vehicle-class">Vehicle Class (optional)</label>
              <select id="booking-vehicle-class" class="field-input">
                <option value="">No selection</option>
              </select>

              <label class="field-label" for="booking-car">Vehicle (optional)</label>
              <input
                id="booking-car"
                type="text"
                class="field-input"
                placeholder="e.g., BMW M3, License plate"
              />

              <label class="field-label" for="booking-main-service">Package (optional)</label>
              <select id="booking-main-service" class="hidden"></select>
              <div class="settings-dropdown">
  <button
    type="button"
    class="settings-dropdown-toggle"
    id="booking-package-toggle"
    aria-expanded="false"
  >
    <span id="booking-package-label">Select package</span>
    <span class="settings-dropdown-chevron">▾</span>
  </button>

  <div id="booking-package-menu" class="settings-dropdown-menu"></div>
</div>

<div class="booking-services-group">
  <label class="field-label optional">Single Services (optional)</label>

  <div class="settings-dropdown booking-singles-dropdown">
<button
  type="button"
  class="settings-dropdown-toggle"
  id="booking-singles-toggle"
  aria-expanded="false"
>
  <span id="booking-singles-label">Select single services</span>
  <span class="settings-dropdown-chevron">▾</span>
</button>

    <div
      id="booking-singles-menu"
      class="settings-dropdown-menu"
    >
      <p class="form-hint">No single services created yet.</p>
    </div>
  </div>

  <select id="booking-singles-list" multiple class="hidden"></select>

  <p class="form-hint">Multiple services can be selected.</p>
</div>

              <button
                type="button"
                id="booking-next-1"
                class="btn btn-secondary btn-block"
                style="margin-top:16px;"
              >
                Next to Appointment
              </button>
            </div>

            <div class="booking-step hidden" id="booking-step-2" data-step="2">
              <h4 class="settings-subtitle">Appointment</h4>
              <div class="booking-datetime-row">
                <div>
                  <label class="field-label" for="booking-date">Date</label>
                  <input id="booking-date" type="date" class="field-input" />
                </div>
                <div>
                  <label class="field-label" for="booking-time">Time</label>
                  <input id="booking-time" type="time" step="900" class="field-input" />
                </div>
              </div>

              <div class="booking-step-actions" style="margin-top:16px;">
                <button type="button" id="booking-back-2" class="btn btn-ghost btn-small">
                  Back
                </button>
                <button
                  type="button"
                  id="booking-next-2"
                  class="btn btn-secondary btn-small"
                  style="float:right;"
                >
                  Next to Customer
                </button>
              </div>
            </div>

            <div class="booking-step hidden" id="booking-step-3" data-step="3">
              <h4 class="settings-subtitle">Customer (optional)</h4>
              <label class="field-label" for="booking-customer-name">Name</label>
              <input id="booking-customer-name" type="text" class="field-input" />

              <label class="field-label" for="booking-customer-email">Email</label>
              <input id="booking-customer-email" type="email" class="field-input" />

              <label class="field-label" for="booking-customer-phone">Phone</label>
              <input id="booking-customer-phone" type="tel" class="field-input" />

              <label class="field-label" for="booking-customer-address">Address</label>
              <input id="booking-customer-address" type="text" class="field-input" />

              <label class="field-label" for="booking-notes">Notes (optional)</label>
              <textarea id="booking-notes" class="field-input" rows="3"></textarea>

              <h4 class="settings-subtitle" style="margin-top:12px;">Discount (optional)</h4>
              <div class="form-row">
                <label class="field-label" for="booking-discount-type">Discount Type</label>
                <select id="booking-discount-type" class="field-input">
                  <option value="none">No discount</option>
                  <option value="amount">Amount ($)</option>
                  <option value="percent">Percent (%)</option>
                </select>
              </div>

              <div class="form-row">
                <label class="field-label" for="booking-discount-value">Discount Value</label>
                <input
                  id="booking-discount-value"
                  type="number"
                  class="field-input"
                  placeholder="e.g., 10"
                  step="0.01"
                  min="0"
                />
                <p class="form-hint">
                  Amount: USD. Percent: 0–100.
                </p>
              </div>

              <div class="booking-step-actions" style="margin-top:16px;">
                <button type="button" id="booking-back-3" class="btn btn-ghost btn-small">
                  Back
                </button>
                <button type="submit" class="btn btn-primary btn-small" style="float:right;">
                  Create Order
                </button>
              </div>
            </div>

            <div class="booking-summary glass" style="margin-top:16px; padding:12px;">
              <p><strong>Total Price:</strong> <span id="booking-summary-price">$ 0.00</span></p>
              <p><strong>Total Time:</strong> <span id="booking-summary-duration">0 hrs.</span></p>
            </div>
          </form>
          <p id="booking-error" class="error-text"></p>
        </div>
      </div>

      <div id="booking-detail-modal" class="profile-modal hidden">
        <div class="profile-modal-backdrop"></div>
        <div class="profile-modal-card glass">
          <div class="profile-modal-header">
            <h3 id="booking-detail-title">Order</h3>
            <button
              id="booking-detail-close"
              class="icon-button small"
              type="button"
              title="Close"
            >
              ✕
            </button>
          </div>

          <div class="booking-detail-body">
            <p id="booking-detail-meta"></p>

            <p id="booking-detail-price" class="price"></p>

            <details class="modal-section">
              <summary>Booking Details</summary>

  <div class="modal-section">
    <label class="field-label" for="booking-detail-date">Appointment</label>
    <div class="booking-datetime-row">
      <div>
        <input
          id="booking-detail-date"
          type="date"
          class="field-input"
        />
      </div>
      <div>
        <input
          id="booking-detail-time"
          type="time"
          step="900"
          class="field-input"
        />
      </div>
    </div>
  </div>

  <div class="modal-section">
    <label class="field-label" for="booking-detail-car">Vehicle</label>
    <input
      id="booking-detail-car"
      type="text"
      class="field-input"
      placeholder="e.g., BMW M3, License plate"
    />
  </div>

  <div class="modal-section">
    <label class="field-label" for="booking-detail-vehicle-class">
      Vehicle Class
    </label>
    <select id="booking-detail-vehicle-class" class="field-input">
      <option value="">No selection</option>
    </select>
  </div>

  <div class="modal-section">
    <label class="field-label" for="booking-detail-main-service">
      Package (optional)
    </label>
    <select id="booking-detail-main-service" class="hidden"></select>
<div class="settings-dropdown">
  <button
    type="button"
    class="settings-dropdown-toggle"
    id="booking-detail-package-toggle"
    aria-expanded="false"
  >
    <span id="booking-detail-package-label">Select package</span>
    <span class="settings-dropdown-chevron">▾</span>
  </button>

  <div id="booking-detail-package-menu" class="settings-dropdown-menu"></div>
</div>
    <p class="form-hint">
      Optional main package for this order.
    </p>
  </div>

<div class="modal-section">
  <label class="field-label">Single Services</label>

  <div class="settings-dropdown booking-singles-dropdown">
<button
  type="button"
  class="settings-dropdown-toggle"
  id="booking-detail-singles-toggle"
  aria-expanded="false"
>
  <span id="booking-detail-singles-label">Select single services</span>
  <span class="settings-dropdown-chevron">▾</span>
</button>
    <div
      class="settings-dropdown-menu"
      id="booking-detail-singles-menu"
    >
      <p class="form-hint">No single services created yet.</p>
    </div>
  </div>

  <select
    id="booking-detail-singles-list"
    multiple
    class="hidden"
  ></select>

  <p class="form-hint">Multiple services can be selected.</p>
</div>

  <div class="modal-section">
    <label class="field-label" for="booking-detail-discount-type">
      Discount Type
    </label>
    <select id="booking-detail-discount-type" class="field-input">
      <option value="none">No discount</option>
      <option value="amount">Amount ($)</option>
      <option value="percent">Percent (%)</option>
    </select>
  </div>

  <div class="modal-section">
    <label class="field-label" for="booking-detail-discount-value">
      Discount Value
    </label>
    <input
      id="booking-detail-discount-value"
      type="number"
      class="field-input"
      step="0.01"
      min="0"
      placeholder="e.g., 10"
    />
  </div>
            </details>

            <details class="modal-section">
              <summary>Customer</summary>

              <div class="modal-section">
                <label class="field-label" for="booking-detail-customer-name">Name</label>
                <input
                  id="booking-detail-customer-name"
                  type="text"
                  class="field-input"
                />
              </div>

              <div class="modal-section">
                <label class="field-label" for="booking-detail-customer-email">Email</label>
                <input
                  id="booking-detail-customer-email"
                  type="email"
                  class="field-input"
                />
              </div>

              <div class="modal-section">
                <label class="field-label" for="booking-detail-customer-phone">Phone</label>
                <input
                  id="booking-detail-customer-phone"
                  type="tel"
                  class="field-input"
                />
              </div>

              <div class="modal-section">
                <label class="field-label" for="booking-detail-customer-address">Address</label>
                <input
                  id="booking-detail-customer-address"
                  type="text"
                  class="field-input"
                />
              </div>
            </details>

            <div class="modal-section">
              <label class="field-label" for="booking-detail-notes">Notes</label>
              <textarea
                id="booking-detail-notes"
                class="field-input"
                rows="4"
                placeholder="Internal notes for the order"
              ></textarea>
            </div>

            <div class="modal-section">
              <h4 class="settings-subtitle">Status</h4>

              <label class="field-label" for="booking-detail-job-status">
                Order Status
              </label>
              <select
                id="booking-detail-job-status"
                class="field-input"
              >
                <option value="planned">Planned</option>
                <option value="in_progress">In Progress</option>
                <option value="done">Completed</option>
                <option value="canceled">Canceled</option>
              </select>

              <label
                class="field-label"
                for="booking-detail-payment-status"
                style="margin-top:8px;"
              >
                Payment Status
              </label>
              <select
                id="booking-detail-payment-status"
                class="field-input"
              >
                <option value="open">Open</option>
                <option value="partial">Partial Payment</option>
                <option value="paid">Paid</option>
              </select>
            </div>

              <div class="modal-section payment-partial-row">
                <label class="field-label" for="booking-detail-partial-amount">
                  Already Paid (Partial payment, in $)
                </label>
                <input
                  id="booking-detail-partial-amount"
                  type="number"
                  class="field-input"
                  step="0.01"
                  min="0"
                  placeholder="e.g., 100"
                />
              </div>

              <div class="modal-section payment-paid-override-row">
                <label
                  class="field-label"
                  for="booking-detail-paid-override-amount"
                >
                  Overriding Total Amount (in $)
                </label>
                <input
                  id="booking-detail-paid-override-amount"
                  type="number"
                  class="field-input"
                  step="0.01"
                  min="0"
                  placeholder="e.g., 299"
                />
                <p class="form-hint">
                  Only fill in if the paid amount differs from the order volume.
                </p>
              </div>

            <div class="modal-buttons">
              <button
                type="button"
                id="booking-detail-delete-button"
                class="btn btn-danger"
              >
                Delete Order
              </button>
              <button
                type="button"
                id="booking-detail-save"
                class="btn btn-primary"
              >
                Save Changes
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="intake-modal" class="profile-modal hidden">
  <div class="profile-modal-backdrop"></div>
  <div class="profile-modal-card glass">
    <div class="profile-modal-header">
      <h3>Intake Protocol</h3>
      <button id="intake-close-button" class="icon-button small" type="button" title="Close">✕</button>
    </div>

    <div class="booking-steps-indicator">
      <span id="intake-step-indicator-1" class="booking-step-indicator active">1. Order</span>
      <span id="intake-step-indicator-2" class="booking-step-indicator">2. Vehicle</span>
      <span id="intake-step-indicator-3" class="booking-step-indicator">3. Check</span>
      <span id="intake-step-indicator-4" class="booking-step-indicator">4. Exterior</span>
      <span id="intake-step-indicator-5" class="booking-step-indicator">5. Interior</span>
      <span id="intake-step-indicator-6" class="booking-step-indicator">6. Legal</span>
    </div>

    <form id="intake-form" class="form">

      <div class="booking-step" id="intake-step-1" data-step="1">
        <div class="glass" style="padding:12px;">
          <p class="form-hint" style="margin:0 0 10px;">
            Order has been selected. You can adjust the date.
          </p>

          <div class="booking-datetime-row">
  <div>
    <label class="field-label" for="intake-doc-date">Date</label>
    <input id="intake-doc-date" type="date" class="field-input" />
  </div>
  <div>
    <label class="field-label" for="intake-doc-time">Time</label>
    <input id="intake-doc-time" type="time" class="field-input" />
  </div>
</div>

          <label class="field-label" for="intake-customer-note">Customer Note (visible)</label>
          <textarea id="intake-customer-note" class="field-input" rows="3"></textarea>
        </div>

        <div class="modal-actions">
          <button id="intake-next-1" type="button" class="btn btn-primary-alt">Next</button>
        </div>
      </div>

      <div class="booking-step hidden" id="intake-step-2" data-step="2">
  <div class="glass" style="padding:12px;">
    <label class="field-label" for="intake-vehicle-make-model">Vehicle (Make & Model)</label>
    <input id="intake-vehicle-make-model" type="text" class="field-input" placeholder="e.g., BMW M3" />

    <label class="field-label" for="intake-vehicle-vin">VIN (optional)</label>
    <input id="intake-vehicle-vin" type="text" class="field-input" />

    <label class="field-label" for="intake-vehicle-plate">License Plate</label>
    <input id="intake-vehicle-plate" type="text" class="field-input" placeholder="e.g., ABC-1234" />

    <label class="field-label" for="intake-vehicle-year">Year</label>
    <input id="intake-vehicle-year" type="number" class="field-input" inputmode="numeric" />

    <label class="field-label" for="intake-vehicle-mileage">Mileage</label>
    <input id="intake-vehicle-mileage" type="number" class="field-input" inputmode="numeric" />
  </div>

  <div class="modal-actions">
    <button id="intake-back-2" type="button" class="btn btn-ghost">Back</button>
    <button id="intake-next-2" type="button" class="btn btn-primary-alt">Next</button>
  </div>
</div>

      <div class="booking-step hidden" id="intake-step-3" data-step="3">
        <div class="glass" style="padding:12px;">
          <p class="form-hint" style="margin:0 0 10px;">
            Required fields: Please select Yes/No for all points.
          </p>

          <label class="field-label" for="intake-q-damages">Are there visible damages?</label>
          <select id="intake-q-damages" class="field-input">
            <option value="">Please select…</option>
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>

          <label class="field-label" for="intake-q-odors">Are odors noticeable?</label>
          <select id="intake-q-odors" class="field-input">
            <option value="">Please select…</option>
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>

          <label class="field-label" for="intake-q-valuables">Were valuables left in the vehicle?</label>
          <select id="intake-q-valuables" class="field-input">
            <option value="">Please select…</option>
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>

          <label class="field-label">Current Fuel Level</label>
<div id="intake-fuel-pill" class="pill-group">
  <button type="button" class="pill" data-value="25">¼</button>
  <button type="button" class="pill" data-value="50">½</button>
  <button type="button" class="pill" data-value="75">¾</button>
  <button type="button" class="pill" data-value="100">Full</button>
</div>

          <label class="field-label" for="intake-check-notes">Additional Notes for Checklist (optional)</label>
          <textarea id="intake-check-notes" class="field-input" rows="3"></textarea>
        </div>

        <div class="modal-actions">
          <button id="intake-back-3" type="button" class="btn btn-ghost">Back</button>
          <button id="intake-next-3" type="button" class="btn btn-primary-alt">Next</button>
        </div>
      </div>

      <div class="booking-step hidden" id="intake-step-4" data-step="4">
        <p class="form-hint" style="margin-top:0;">
          Exterior shots: Add photos for each point + optional note.
        </p>

        <div id="intake-exterior-points"></div>

        <div class="modal-actions">
          <button id="intake-back-4" type="button" class="btn btn-ghost">Back</button>
          <button id="intake-next-4" type="button" class="btn btn-primary-alt">Next</button>
        </div>
      </div>

      <div class="booking-step hidden" id="intake-step-5" data-step="5">
        <p class="form-hint" style="margin-top:0;">
          Interior shots: Add photos for each point + optional note.
        </p>

        <div id="intake-interior-points"></div>

        <div class="modal-actions">
          <button id="intake-back-5" type="button" class="btn btn-ghost">Back</button>
          <button id="intake-next-5" type="button" class="btn btn-primary-alt">Next</button>
        </div>
      </div>

      <div class="booking-step hidden" id="intake-step-6" data-step="6">
        <div class="glass" style="padding:12px;">
          <label class="field-label" style="margin-top:0;">Legal</label>

          <label class="form-hint" style="display:flex; gap:10px; align-items:flex-start; user-select:none;">
            <input id="intake-legal-handover" type="checkbox" />
            <span>Customer confirms the vehicle handover in the documented condition.</span>
          </label>

          <label class="form-hint" style="display:flex; gap:10px; align-items:flex-start;">
  <input id="intake-legal-hidden-damages" type="checkbox" />
  <span>
    Customer confirms that possible damages due to dirt were not visible upon handover.
  </span>
</label>

          <label class="form-hint" style="display:flex; gap:10px; align-items:flex-start; user-select:none;">
            <input id="intake-legal-terms" type="checkbox" />
            <span>Customer accepts the terms and conditions and privacy policy.</span>
          </label>

          <label class="field-label" style="margin-top:12px;">Customer Signature</label>
          <div class="glass intake-signature-wrap">
            <canvas id="intake-signature-canvas" style="width:100%; height:160px; border-radius:14px;"></canvas>

            <div style="display:flex; gap:8px; margin-top:10px;">
              <button id="intake-signature-clear" type="button" class="btn btn-ghost" style="flex:1;">Delete</button>
              <button id="intake-signature-apply" type="button" class="btn btn-secondary" style="flex:1;">Apply</button>
            </div>
          </div>

<label class="field-label" for="intake-send-email" style="margin-top:14px;">Send intake report via email</label>
          <select id="intake-send-email" class="field-input">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>

          <div id="intake-email-panel" style="margin-top:10px; display:none;">
            <label class="field-label" for="intake-customer-email">Customer Email</label>
            <input id="intake-customer-email" type="email" class="field-input" autocomplete="email" />
          </div>

          <p id="intake-final-error" class="error-text" style="margin-top:10px; color: #ef4444; font-weight: bold;"></p>
          <p id="intake-final-success" class="form-hint" style="margin-top:10px;"></p>

          <div class="modal-actions">
            <button id="intake-back-6" type="button" class="btn btn-ghost">Back</button>
            <button id="intake-finish" type="submit" class="btn btn-primary-alt">Complete</button>
          </div>
        </div> </div> </form>
  </div>
</div>

      <div id="review-modal" class="profile-modal hidden">
        <div class="profile-modal-backdrop"></div>
        <div class="profile-modal-card glass">
          <div class="profile-modal-header">
            <h3>Request Review</h3>
            <button
              id="review-modal-close"
              class="icon-button small"
              type="button"
              title="Close"
            >
              ✕
            </button>
          </div>

          <div class="form">
            <p id="review-modal-text" class="form-hint" style="user-select:text;">
              </p>

            <button
              type="button"
              id="review-modal-copy"
              class="btn btn-secondary"
              style="margin-top:12px;"
            >
              Copy text
            </button>

            <button
              type="button"
              id="review-modal-done"
              class="btn btn-primary"
              style="margin-top:8px;"
            >
              Done
            </button>
          </div>
        </div>
      </div>

      <nav class="bottom-nav glass">
        <button class="nav-item active" data-tab="dashboard">
          <span class="nav-icon">
            <img src="dashboard-icon.png" alt="Dashboard" />
          </span>
          <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-item" data-tab="schedule">
          <span class="nav-icon">
            <img src="zeitplan-icon.png" alt="Schedule" />
          </span>
          <span class="nav-label">Schedule</span>
        </button>
<button class="nav-item" data-tab="orders">
  <span class="nav-icon">
    <img src="auftragsannahme.png" alt="Intake Protocol" />
  </span>
  <span class="nav-label">Intake Protocol</span>
</button>
        <button class="nav-item" data-tab="settings">
          <span class="nav-icon">
            <img src="einstellungen-icon.png" alt="Settings" />
          </span>
          <span class="nav-label">Settings</span>
        </button>
      </nav>
    </div>
  </div>

  <script src="app.js?v1.02"></script>
</body>
</html>
